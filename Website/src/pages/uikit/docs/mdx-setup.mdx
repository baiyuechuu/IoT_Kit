# MDX and Custom Code Blocks Setup Guide

Welcome to the comprehensive guide for setting up MDX (Markdown + JSX) with custom code blocks in your React + Vite project.

## Overview

MDX allows you to write JSX directly in your Markdown files, making it perfect for interactive documentation, component showcases, and rich content experiences.

## Prerequisites

- React 18+ project
- Vite as build tool
- TypeScript (recommended)
- Tailwind CSS for styling

## Installation

### 1. Install Core MDX Dependencies

```bash
npm install @mdx-js/mdx @mdx-js/react @mdx-js/rollup
```

### 2. Install MDX Types (TypeScript)

```bash
npm install --save-dev @types/mdx
```

### 3. Install Syntax Highlighting Dependencies

```bash
npm install react-syntax-highlighter @types/react-syntax-highlighter
npm install prism-themes rehype-highlight rehype-prism-plus
```

### 4. Install Markdown Processing Plugins

```bash
npm install remark-gfm rehype-autolink-headings rehype-slug
```

## Vite Configuration

Configure Vite to process MDX files by updating your `vite.config.ts`:

```typescript
import path from "path";
import tailwindcss from "@tailwindcss/vite";
import react from "@vitejs/plugin-react";
import { defineConfig } from "vite";
import mdx from "@mdx-js/rollup";
import remarkGfm from "remark-gfm";
import rehypeHighlight from "rehype-highlight";
import rehypePrism from "rehype-prism-plus";

export default defineConfig({
  plugins: [
    react(),
    tailwindcss(),
    mdx({
      remarkPlugins: [remarkGfm], // GitHub Flavored Markdown
      rehypePlugins: [
        rehypeHighlight, // Syntax highlighting
        rehypePrism,     // Enhanced Prism support
      ],
      providerImportSource: "@mdx-js/react",
    }),
  ],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
});
```

## TypeScript Configuration

Add MDX module declaration to your `vite-env.d.ts`:

```typescript
/// <reference types="vite/client" />

declare module "*.mdx" {
  let MDXComponent: (props: any) => JSX.Element;
  export default MDXComponent;
}
```

## Custom MDX Components

Create a comprehensive MDX components configuration:

### Basic Components Setup

```typescript
// src/components/mdx/MDXComponents.tsx
import { Button } from "@/components/ui/button";
import { Copy, Check } from "lucide-react";
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";
import { oneDark, oneLight } from "react-syntax-highlighter/dist/esm/styles/prism";
import { useState, useEffect } from "react";

export const mdxComponents = {
  // Custom headings with proper styling
  h1: (props: any) => (
    <h1 className="text-4xl font-bold my-6 first:mt-0 text-foreground" {...props} />
  ),
  h2: (props: any) => (
    <h2 className="text-3xl font-semibold my-6 first:mt-0 text-foreground" {...props} />
  ),
  h3: (props: any) => (
    <h3 className="text-2xl font-medium my-6 text-foreground" {...props} />
  ),
  
  // Enhanced paragraphs and text
  p: (props: any) => (
    <p className="leading-8 text-left text-lg text-muted-foreground" {...props} />
  ),
  
  // Lists with proper spacing
  ul: (props: any) => (
    <ul className="list-disc pl-8 text-left text-lg text-muted-foreground" {...props} />
  ),
  ol: (props: any) => (
    <ol className="list-decimal pl-8 mb-6 text-left text-lg text-muted-foreground" {...props} />
  ),
  li: (props: any) => <li className="mt-3 leading-8 text-left" {...props} />,
  
  // Inline code
  code: ({ className, ...props }: React.HTMLAttributes<HTMLElement>) => (
    <code
      className="relative rounded bg-muted px-[0.3rem] py-[0.2rem] font-mono text-sm"
      {...props}
    />
  ),
};
```

### Advanced Code Block Component

The real magic happens with custom `pre` component that creates beautiful, themed code blocks:

```typescript
// Enhanced pre component with copy functionality and theme detection
pre: (props: any) => {
  const [copied, setCopied] = useState(false);
  const [isDark, setIsDark] = useState(false);

  // Extract code content and language
  const codeElement = props.children;
  const getTextContent = (element: any): string => {
    if (typeof element === "string") return element;
    if (typeof element === "number") return String(element);
    if (Array.isArray(element)) return element.map(getTextContent).join("");
    if (element?.props?.children) return getTextContent(element.props.children);
    return "";
  };

  const code = getTextContent(
    codeElement?.props?.children || codeElement || ""
  ).trim();
  const className = codeElement?.props?.className || "";
  const language = className.replace(/language-/, "") || "text";

  // Reactive theme detection
  useEffect(() => {
    const checkTheme = () => {
      setIsDark(document.documentElement.classList.contains("dark"));
    };

    checkTheme();
    const observer = new MutationObserver(checkTheme);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["class"],
    });

    return () => observer.disconnect();
  }, []);

  const copyToClipboard = async () => {
    await navigator.clipboard.writeText(code);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  // Custom theme styles
  const enhancedDarkTheme = {
    ...oneDark,
    'pre[class*="language-"]': {
      ...oneDark['pre[class*="language-"]'],
      background: "transparent",
      fontFamily: '"JetBrains Mono", "Fira Code", "SF Mono", Monaco, monospace',
      fontSize: "15px",
      lineHeight: "1.6",
      padding: "24px",
      color: "hsl(var(--foreground))",
    },
  };

  const enhancedLightTheme = {
    ...oneLight,
    'pre[class*="language-"]': {
      ...oneLight['pre[class*="language-"]'],
      background: "transparent",
      fontFamily: '"JetBrains Mono", "Fira Code", "SF Mono", Monaco, monospace',
      fontSize: "15px",
      lineHeight: "1.6",
      padding: "24px",
      color: "hsl(var(--foreground))",
    },
  };

  return (
    <div className="my-8 space-y-6">
      <div className="rounded-xl overflow-hidden border-2 shadow-lg bg-card">
        {/* Terminal-style header */}
        <div className="flex items-center justify-between px-3 py-2 bg-muted/50 border-b">
          <div className="flex items-center gap-3">
            <div className="flex gap-2">
              <div className="w-3 h-3 rounded-full bg-red-500"></div>
              <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
              <div className="w-3 h-3 rounded-full bg-green-500"></div>
            </div>
            <span className="text-sm font-medium text-muted-foreground font-mono">
              {language.toUpperCase()}
            </span>
          </div>
          <Button size="sm" variant="ghost" onClick={copyToClipboard} className="h-8 px-3">
            {copied ? <Check className="w-4 h-4" /> : <Copy className="w-4 h-4" />}
          </Button>
        </div>

        {/* Code content */}
        <div className="relative bg-card">
          <SyntaxHighlighter
            language={language}
            style={isDark ? enhancedDarkTheme : enhancedLightTheme}
            customStyle={{
              margin: 0,
              borderRadius: 0,
              background: "hsl(var(--card))",
            }}
            showLineNumbers={false}
            wrapLines={true}
            wrapLongLines={true}
            tabSize={4}
          >
            {code}
          </SyntaxHighlighter>
        </div>
      </div>
    </div>
  );
},
```

## Using MDX Components in Your App

### 1. Provider Setup

Wrap your app with the MDX provider:

```typescript
// src/App.tsx or main layout
import { MDXProvider } from '@mdx-js/react';
import { mdxComponents } from '@/components/mdx/MDXComponents';

function App() {
  return (
    <MDXProvider components={mdxComponents}>
      {/* Your app content */}
    </MDXProvider>
  );
}
```

### 2. Importing and Using MDX Files

```typescript
// Dynamic import with lazy loading
import { lazy } from 'react';

const MyMDXDocument = lazy(() => import('./docs/my-document.mdx'));

// Usage in component
function DocumentationPage() {
  return (
    <div className="prose prose-neutral dark:prose-invert">
      <Suspense fallback={<div>Loading...</div>}>
        <MyMDXDocument />
      </Suspense>
    </div>
  );
}
```

### 3. Component Registration System

For organized component documentation:

```typescript
// src/pages/uikit/components/index.tsx
export interface ComponentSection {
  id: string;
  title: string;
  description: string;
  icon: React.ReactNode;
  documentation?: React.ComponentType;
}

export const componentSections: ComponentSection[] = [
  {
    id: "example",
    title: "Example Article",
    description: "Example MDX article",
    icon: <FileTextIcon className="w-5 h-5" />,
    documentation: lazy(() => import("../docs/example.mdx")),
  },
];
```

## Advanced Features

### Custom Callout Components

Add special callout boxes to your MDX:

```typescript
// In mdxComponents
Callout: ({ type = "info", children, ...props }: any) => (
  <div
    className={`py-3 px-5 rounded-xl border-2 text-left shadow-sm my-6 ${
      type === "warning"
        ? "bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800"
        : type === "error"
        ? "bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800"
        : type === "success"
        ? "bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800"
        : "bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800"
    }`}
    {...props}
  >
    <div className="text-lg leading-relaxed">{children}</div>
  </div>
),
```

Usage in MDX:

```jsx
<Callout type="warning">
This is a warning callout!
</Callout>

<Callout type="success">
Great job! This worked perfectly.
</Callout>
```

### Interactive Code Preview Component

Create live code previews with the `CodePreview` component:

```typescript
// CodePreview component allows live preview + code display
<CodePreview 
  code={`import { Button } from "@/components/ui/button";

export function MyButton() {
  return (
    <Button variant="default" size="lg">
      Click me!
    </Button>
  );
}`}
  language="tsx"
  title="Interactive Button Example"
>
  <Button variant="default" size="lg">
    Click me!
  </Button>
</CodePreview>
```

### Best Practices

1. **Use semantic headings** - Start with h1, use h2 for sections, h3 for subsections
2. **Include interactive examples** - Use CodePreview for live demonstrations
3. **Add callouts for important info** - Highlight warnings, tips, and notes
4. **Code syntax highlighting** - Always specify language for code blocks
5. **Responsive design** - Test documentation on different screen sizes

## Styling and Theming

### Dark/Light Mode Support

The setup automatically detects and responds to theme changes:

- Code blocks adapt to current theme
- Syntax highlighting switches between light/dark variants
- Components use CSS custom properties for theming

### Custom Fonts for Code

The setup includes a font stack optimized for code readability:

```css
font-family: "JetBrains Mono", "Fira Code", "SF Mono", Monaco, Inconsolata, "Roboto Mono", "Source Code Pro", monospace;
```

## Troubleshooting

### Common Issues

1. **MDX files not loading**: Ensure vite.config.ts includes MDX plugin
2. **Syntax highlighting not working**: Check rehype plugins are installed
3. **Components not rendering**: Verify MDXProvider wraps your app
4. **TypeScript errors**: Add MDX module declaration to vite-env.d.ts

### Performance Tips

1. Use lazy loading for large MDX files
2. Implement Suspense boundaries for better UX
3. Keep MDX components lightweight
4. Optimize images and media in documentation

## Conclusion

This setup provides a powerful, flexible foundation for creating interactive documentation with MDX. The custom code blocks offer professional syntax highlighting, copy functionality, and theme adaptation, while the component system allows for rich, interactive content.

Start creating your first MDX file and experience the power of combining Markdown with React components! 